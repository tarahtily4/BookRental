{% extends "base.html" %}
{% block content %}
<h2>Підписка (300 грн/міс.)</h2>
<p>Оформіть підписку, щоб оформляти оренду без додаткових оплат за кожне замовлення.</p>
<form id="checkout-form" method="post" action="{% url 'payments:create_checkout_session' %}">
  {% csrf_token %}
  <button class="btn btn-primary">Оплатити підписку</button>
</form>
<script src="https://js.stripe.com/v3/"></script>
<script>
  const form = document.getElementById('checkout-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const resp = await fetch(form.action, {method:'POST', headers: {'X-CSRFToken': '{{ csrf_token }}'}});
    const data = await resp.json();
    const stripe = Stripe("{{ stripe_public_key }}");
    stripe.redirectToCheckout({ sessionId: data.id });
  });
</script>
{% endblock %}
